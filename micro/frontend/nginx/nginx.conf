# Kullanıcı işlemleri için ayarlar
worker_processes auto;

events {
    # Eşzamanlı bağlantılar için ayarlar
    worker_connections 1024;
}

http {
# HTTP'den HTTPS'ye yönlendirme için sunucu bloğu

    types { application/javascript js;
    }
        
    include       /etc/nginx/mime.types;
    default_type  text/html;

    server {
        listen 80;
        server_name localhost;
        return 301 https://$host$request_uri; # HTTP'den HTTPS'ye yönlendirme
    }
    
    server {
        listen 443 ssl;
        listen [::]:8000 ssl http2;


        # SSL sertifikası ve anahtar dosyası yolları
        ssl_certificate /etc/ssl/certs/www.teletubbies.com.crt;
        ssl_certificate_key /etc/ssl/private/www.teletubbies.com.key;
        ssl_protocols       TLSv1.2 TLSv1.3;
        ssl_ciphers         HIGH:!aNULL:!MD5;
        # Web kök dizini
        
        # Statik dosyalara erişim
        location / {
            try_files $uri $uri/ /index.html; # Tüm istekleri index.html'e yönlendir
            root /usr/share/nginx/html/; # Nginx'in statik dosyaları dağıtacağı dizin
            index index.html index.htm; # Varsayılan index dosyası

        }

        # API yolu için proxy yapılandırması
        location /api/ {
            proxy_pass http://backend:8000; # API isteklerini backend servisine yönlendir
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # WebSocket support
        location /ws/ {
            proxy_pass http://backend:8000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            # Adjust the buffer size for WebSocket connections
            proxy_buffers 8 32k;
            proxy_buffer_size 64k;
        }

        location ~* \.js$ {
        root  /usr/share/nginx/html/;
        add_header Content-Type application/javascript;
        }

        # location /static/ {
        #     alias /usr/share/nginx/html/src/;
        # }
        # SSL yapılandırmaları ve diğer güvenlik ayarları...
    }

}

# # Kullanıcı işlemleri için ayarlar
# worker_processes auto;

# events {
#     # Eşzamanlı bağlantılar için ayarlar
#     worker_connections 1024;
# }

# http {
#     # MIME türleri için dosya
#     include mime.types;
#     # Varsayılan dosya türü
#     default_type application/octet-stream;

#     # Log dosyalarının yolu
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     # Dosya gönderimlerindeki maksimum boyut
#     client_max_body_size 16M;

#     # Sunucu yapılandırmalarını içeren dosyalar
#     include /etc/nginx/conf.d/*.conf;
#     include /etc/nginx/sites-enabled/*;

#     # HTTP sunucusu yapılandırması
#     # server {
#     #     listen 80;
#     #     server_name www.teletubbies.com;

#     #     # Web kök dizini
#     #     root /usr/share/nginx/html;
#     #     # Varsayılan index dosyası
#     #     index index.html index.htm;

#     #     # Statik dosyalara erişim
#     #     location / {
#     #         try_files $uri $uri/ =404;
#     #     }
#     # }
#     # resolver 127.0.0.11 valid=30s; 
#     # HTTPS sunucusu yapılandırması
#     server {
#         listen 443 ssl;
#         server_name www.teletubbies.com;

#         # SSL sertifikası ve anahtar dosyası yolları
#         ssl_certificate /etc/ssl/certs/www.teletubbies.com.crt;
#         ssl_certificate_key /etc/ssl/private/www.teletubbies.com.key;

#         # Web kök dizini
#         root /usr/share/nginx/html;
#         # Varsayılan index dosyası
#         index index.html index.htm;

#         # Statik dosyalara erişim
#         location / {
#             try_files $uri $uri/ /index.html;
#             proxy_pass http://frontend:80;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }

#         location /api/ {
#             proxy_pass http://localhost:8000;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }
#         # SSL yapılandırmaları
#         ssl_session_timeout 5m;
#         ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
#         ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
#         ssl_session_cache shared:SSL:1m;
#         ssl_prefer_server_ciphers on;
#     }
# }


# # server {
# #     listen 443 ssl;
# #     server_name www.teletubbie.com;

# #     ssl_certificate /etc/ssl/certs/www.teletubbie.com.crt;
# #     ssl_certificate_key /etc/ssl/private/www.teletubbie.com.key;


# #     location / {
# #         try_files $uri $uri/ /index.html;
# #         proxy_pass http://frontend:80;
# #         proxy_set_header Host $host;
# #         proxy_set_header X-Real-IP $remote_addr;
# #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# #         proxy_set_header X-Forwarded-Proto $scheme;
# #     }

# #     location /api/ {
# #         proxy_pass http://backend:8000;
# #         proxy_set_header Host $host;
# #         proxy_set_header X-Real-IP $remote_addr;
# #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# #         proxy_set_header X-Forwarded-Proto $scheme;
# #     }
# # }
